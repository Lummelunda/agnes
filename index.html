<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vad s√§ger Agnes?</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .category-btn { transition: all 0.2s; }
        .category-btn:hover { transform: translateY(-2px); }
        .category-btn.active { background-color: #2563eb; color: white; border-color: #2563eb; }
        .result-card { transition: all 0.2s; }
        .result-card:hover { transform: translateY(-1px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <div class="bg-white border-b border-gray-200 pt-16 pb-10 px-4 shadow-sm">
        <div class="max-w-4xl mx-auto text-center">
            
            <h1 class="text-4xl md:text-6xl font-extrabold text-slate-900 mb-4 tracking-tight">
                Vad s√§ger <span class="text-blue-600">Agnes?</span>
            </h1>
            
            <div class="relative max-w-2xl mx-auto mt-8">
                <input type="text" id="searchInput" 
                    class="w-full pl-6 pr-12 py-4 rounded-full shadow-lg border-2 border-slate-100 text-lg focus:outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition"
                    placeholder="S√∂k efter socker, st√§dning, virus..." autofocus>
                <div class="absolute right-5 top-4 text-2xl cursor-pointer hover:scale-110 transition" onclick="resetApp()">
                    ‚úñÔ∏è
                </div>
            </div>
        </div>
    </div>

    <main class="flex-grow max-w-4xl mx-auto px-4 py-8 w-full">
        
        <div id="quick-filters" class="mb-10">
            <h2 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-4 text-center">V√§lj √§mne</h2>
            <div class="flex flex-wrap justify-center gap-2" id="categoryContainer">
                </div>
        </div>

        <div id="resultsHeader" class="hidden text-sm font-semibold text-slate-500 mb-4 flex justify-between items-center">
            <span id="resultCount"></span>
            <button onclick="resetApp()" class="text-blue-600 hover:underline text-xs">Rensa s√∂kning</button>
        </div>
        <div id="results" class="space-y-4"></div>
        
        <div id="emptyState" class="text-center py-12 text-slate-400">
            <p>S√∂k eller v√§lj en kategori f√∂r att b√∂rja.</p>
            <button onclick="showRandom()" class="mt-4 text-sm font-semibold text-blue-600 hover:text-blue-800 hover:underline cursor-pointer">
                üé≤ Slumpa en fr√•ga
            </button>
        </div>

    </main>

    <footer class="bg-slate-50 border-t border-slate-200 py-8 mt-8 text-center text-slate-400 text-sm">
        <p>Baserat p√• podden "Fr√•ga Agnes Wold" (Sveriges Radio).</p>
    </footer>

    <script src="data.js"></script>

    <script>
        let fuse;
        let activeCategory = null;

        // 1. INITIERING
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof agnesData === 'undefined') {
                document.getElementById('results').innerHTML = "<p class='text-red-500 text-center'>Kunde inte hitta data.js!</p>";
                return;
            }
            initSearch();
            generateCategoryButtons();
        });

        function initSearch() {
            const options = {
                includeScore: true,
                threshold: 0.35, 
                ignoreLocation: true,
                keys: [
                    { name: 'question', weight: 0.5 },
                    { name: 'keywords', weight: 0.3 },
                    { name: 'answer', weight: 0.2 }
                ]
            };
            fuse = new Fuse(agnesData, options);
        }

        // 2. SKAPA KATEGORI-KNAPPAR AUTOMATISKT
        function generateCategoryButtons() {
            // H√§mta alla unika kategorier fr√•n datan
            const allCategories = new Set();
            
            agnesData.forEach(item => {
                if (item["category 1"]) allCategories.add(item["category 1"]);
                if (item["category 2"]) allCategories.add(item["category 2"]);
            });

            // Sortera dem (f√∂r att f√• 1, 2, 3... i ordning)
            const sortedCategories = Array.from(allCategories).sort();

            const container = document.getElementById('categoryContainer');
            
            sortedCategories.forEach(cat => {
                // Ta bort siffran i b√∂rjan f√∂r snyggare knapp (t.ex. "2. Hygien" -> "Hygien")
                const label = cat.replace(/^\d+\.\s*/, ''); 
                
                const btn = document.createElement('button');
                btn.className = `category-btn bg-white border border-slate-200 px-3 py-1.5 rounded-full text-sm text-slate-600 font-medium shadow-sm hover:border-blue-300 hover:text-blue-600`;
                btn.innerText = label;
                btn.onclick = () => toggleCategory(cat, btn);
                container.appendChild(btn);
            });
        }

        // 3. HANTERA S√ñKNING OCH FILTRERING
        function performSearch(query) {
            const container = document.getElementById('results');
            const emptyState = document.getElementById('emptyState');
            const header = document.getElementById('resultsHeader');
            const countLabel = document.getElementById('resultCount');

            // Nollst√§ll om tomt
            if (!query && !activeCategory) {
                container.innerHTML = "";
                emptyState.classList.remove('hidden');
                header.classList.add('hidden');
                return;
            }

            emptyState.classList.add('hidden');
            header.classList.remove('hidden');

            let results = [];

            // A: Om vi har en text-s√∂kning, anv√§nd Fuse
            if (query) {
                const fuseResults = fuse.search(query);
                results = fuseResults.map(r => r.item);
            } else {
                // B: Om ingen text, visa allt (f√∂r att sen filtrera p√• kategori)
                results = agnesData;
            }

            // C: Om en kategori √§r vald, filtrera resultaten
            if (activeCategory) {
                results = results.filter(item => 
                    item["category 1"] === activeCategory || 
                    item["category 2"] === activeCategory
                );
            }

            countLabel.innerText = `${results.length} tr√§ffar`;

            if (results.length === 0) {
                container.innerHTML = `<div class="text-center text-slate-500 py-8">Inga tr√§ffar... ü§î</div>`;
                return;
            }

            // Rendera korten
            container.innerHTML = results.slice(0, 50).map(item => {
                // Skapa etiketter f√∂r kategorier
                let tagsHtml = "";
                if(item["category 1"]) tagsHtml += `<span class="bg-blue-100 text-blue-700 text-[10px] px-2 py-1 rounded-full uppercase tracking-wide font-bold">${item["category 1"].replace(/^\d+\.\s*/, '')}</span>`;
                if(item["category 2"]) tagsHtml += `<span class="bg-gray-100 text-gray-600 text-[10px] px-2 py-1 rounded-full uppercase tracking-wide font-bold ml-2">${item["category 2"].replace(/^\d+\.\s*/, '')}</span>`;

                return `
                    <div class="result-card bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                        <div class="mb-3 flex flex-wrap gap-2">
                            ${tagsHtml}
                        </div>
                        <h3 class="font-bold text-lg text-slate-900 mb-3">${item.question}</h3>
                        <div class="bg-slate-50 p-4 rounded-xl mb-4 border border-slate-100">
                            <p class="text-slate-700 leading-relaxed text-sm md:text-base">${item.answer}</p>
                        </div>
                        <div class="flex justify-between items-center text-xs font-medium text-slate-400 border-t border-slate-50 pt-3">
                            <span>üìÖ ${item.date}</span>
                            <a href="${item.url}" target="_blank" class="flex items-center gap-1 text-blue-600 hover:text-blue-800 transition">
                                Lyssna p√• avsnittet ‚Üí
                            </a>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // 4. INTERAKTION
        const searchInput = document.getElementById('searchInput');
        searchInput.addEventListener('input', (e) => performSearch(e.target.value));

        function toggleCategory(catName, btnElement) {
            // √Öterst√§ll alla knappar
            document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));

            if (activeCategory === catName) {
                // Avmarkera om man klickar p√• samma igen
                activeCategory = null;
            } else {
                // Markera ny
                activeCategory = catName;
                btnElement.classList.add('active');
            }
            performSearch(searchInput.value);
        }

        function showRandom() {
            const randomItem = agnesData[Math.floor(Math.random() * agnesData.length)];
            // Vi fuskar genom att s√∂ka p√• den specifika fr√•gan f√∂r att visa just det kortet
            searchInput.value = randomItem.question;
            performSearch(randomItem.question);
        }

        function resetApp() {
            searchInput.value = "";
            activeCategory = null;
            document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
            performSearch("");
        }
    </script>
</body>
</html>
